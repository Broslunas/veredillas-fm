---
import Layout from '../layouts/Layout.astro';
import EpisodeCard from '../components/EpisodeCard.astro';
import { getCollection } from 'astro:content';
import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

const allEpisodes = await getCollection('episodios');
// Get latest 6 episodes for the slider
const recentEpisodes = allEpisodes.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0, 6);
---

<Layout title="Inicio">
    <!-- Background Decor -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="grid-overlay"></div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container relative z-10">
            <div class="hero-grid">
                <div class="hero-content">
                    <div class="hero-badge gs-reveal">
                        <span class="live-dot"></span>
                        <span>En vivo desde el instituto</span>
                    </div>
                    
                    <h1 class="hero-title gs-reveal">
                        <span class="block">Tu voz,</span>
                        <span class="block">Tu m√∫sica,</span>
                        <span class="text-gradient block">Veredillas FM</span>
                    </h1>
                    
                    <p class="hero-desc gs-reveal">
                        La plataforma definitiva para el talento estudiantil. 
                        Entrevistas, m√∫sica en directo y las historias que realmente importan.
                    </p>
                    
                    <div class="hero-actions gs-reveal">
                        <a href="#latest-episodes" class="btn btn-primary btn-lg shine-effect">
                            <span class="icon">‚ñ∂</span> Escuchar Ahora
                        </a>
                        <a href="/about" class="btn btn-outline btn-lg">
                            Conocer M√°s
                        </a>
                    </div>

                    <div class="hero-stats gs-reveal">
                        <div class="stat">
                            <span class="stat-num" data-count={allEpisodes.length}>0</span>
                            <span class="stat-label">Episodios</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat">
                            <span class="stat-num" data-count="100">0</span>%
                            <span class="stat-label">Talento Escolar</span>
                        </div>
                    </div>
                </div>

                <div class="hero-visual gs-visual">
                    <div class="vinyl-container">
                        <div class="vinyl-record">
                            <div class="vinyl-label">
                                <span class="logo-text">VFM</span>
                            </div>
                        </div>
                        <div class="vinyl-cover">
                            <div class="cover-art">
                                <div class="spectrum-bars">
                                    <span></span><span></span><span></span><span></span><span></span>
                                    <span></span><span></span><span></span><span></span><span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Latest Episodes Slider -->
    <section id="latest-episodes" class="episodes-section">
        <div class="container">
            <div class="section-header gs-fade-up">
                <div>
                    <h2 class="section-title">En Tendencia</h2>
                    <p class="section-subtitle">Lo √∫ltimo que est√° sonando en los pasillos</p>
                </div>
                <div class="slider-nav">
                    <button class="swiper-button-prev-custom" aria-label="Previous slide">‚Üê</button>
                    <button class="swiper-button-next-custom" aria-label="Next slide">‚Üí</button>
                </div>
            </div>

            <div class="swiper episodes-swiper gs-fade-up">
                <div class="swiper-wrapper">
                    {recentEpisodes.map((post) => (
                        <div class="swiper-slide">
                            <EpisodeCard post={post} />
                        </div>
                    ))}
                </div>
                <div class="swiper-pagination"></div>
            </div>
            
            <div class="center-action gs-fade-up">
                <a href="/ep" class="btn btn-outline">Ver todos los episodios</a>
            </div>
        </div>
    </section>

    <!-- Marquee Text -->
    <div class="marquee-container">
        <div class="marquee-content">
            <span>‚Ä¢ ENTREVISTAS EXCLUSIVAS ‚Ä¢ M√öSICA EN VIVO ‚Ä¢ NOTICIAS DEL INSTITUTO ‚Ä¢ DEPORTES ‚Ä¢ CULTURA ‚Ä¢</span>
            <span>‚Ä¢ ENTREVISTAS EXCLUSIVAS ‚Ä¢ M√öSICA EN VIVO ‚Ä¢ NOTICIAS DEL INSTITUTO ‚Ä¢ DEPORTES ‚Ä¢ CULTURA ‚Ä¢</span>
        </div>
    </div>

    <!-- About Feature -->
    <section class="info-section">
        <div class="container">
            <div class="info-grid">
                <div class="info-card glass-panel gs-scroll-left">
                    <span class="info-icon">üéôÔ∏è</span>
                    <h3>Hecho por alumnos</h3>
                    <p>Todo el contenido es producido, grabado y editado por nosotros. Aprendemos haciendo.</p>
                </div>
                <div class="info-card glass-panel gs-scroll-up">
                    <span class="info-icon">‚ö°</span>
                    <h3>Tecnolog√≠a Punta</h3>
                    <p>Utilizamos las √∫ltimas herramientas para llevar la radio escolar al siglo XXI.</p>
                </div>
                <div class="info-card glass-panel gs-scroll-right">
                    <span class="info-icon">üåç</span>
                    <h3>Sin Fronteras</h3>
                    <p>Llevamos la voz del Veredillas a todo el mundo a trav√©s del streaming digital.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Final -->
    <section class="final-cta">
        <div class="container">
            <div class="cta-inner gs-scale-up">
                <h2>¬øTienes algo que contar?</h2>
                <p>El micr√≥fono est√° abierto para ti. √önete al equipo de Veredillas FM.</p>
                <a href="/contact" class="btn btn-primary btn-xl">Participar</a>
            </div>
        </div>
    </section>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import Swiper from 'swiper';
    import { Navigation, Pagination, Autoplay } from 'swiper/modules';

    gsap.registerPlugin(ScrollTrigger);

    // Hero Animations
    const tl = gsap.timeline();

    tl.from(".gs-reveal", {
        y: 50,
        opacity: 0,
        duration: 1,
        stagger: 0.2,
        ease: "power3.out"
    })
    .from(".hero-visual", {
        x: 50,
        opacity: 0,
        duration: 1,
        ease: "back.out(1.7)"
    }, "-=0.5");

    // Vinyl Rotation
    gsap.to(".vinyl-record", {
        rotation: 360,
        duration: 10,
        repeat: -1,
        ease: "linear"
    });

    // Stats Counter
    const stats = document.querySelectorAll('.stat-num');
    stats.forEach(stat => {
        const target = parseInt(stat.getAttribute('data-count') || "0");
        gsap.to(stat, {
            innerText: target,
            duration: 2,
            snap: { innerText: 1 },
            ease: "power2.out"
        });
    });

    // Scroll Animations
    gsap.utils.toArray('.gs-fade-up').forEach((elem: any) => {
        gsap.from(elem, {
            scrollTrigger: {
                trigger: elem,
                start: "top 85%",
            },
            y: 50,
            opacity: 0,
            duration: 0.8,
            ease: "power2.out"
        });
    });

    gsap.from(".gs-scroll-left", {
        scrollTrigger: { trigger: ".info-grid", start: "top 80%" },
        x: -50, opacity: 0, duration: 0.8
    });
    
    gsap.from(".gs-scroll-up", {
        scrollTrigger: { trigger: ".info-grid", start: "top 80%" },
        y: 50, opacity: 0, duration: 0.8, delay: 0.2
    });

    gsap.from(".gs-scroll-right", {
        scrollTrigger: { trigger: ".info-grid", start: "top 80%" },
        x: 50, opacity: 0, duration: 0.8, delay: 0.4
    });

    gsap.from(".cta-inner", {
        scrollTrigger: { trigger: ".final-cta", start: "top 85%" },
        scale: 0.9,
        opacity: 0,
        duration: 0.6,
        ease: "back.out(1.7)"
    });

    // Swiper Init
    const swiper = new Swiper('.episodes-swiper', {
        modules: [Navigation, Pagination, Autoplay],
        slidesPerView: 1,
        spaceBetween: 20,
        loop: true,
        autoplay: {
            delay: 5000,
            disableOnInteraction: false,
        },
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next-custom',
            prevEl: '.swiper-button-prev-custom',
        },
        breakpoints: {
            640: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            1024: {
                slidesPerView: 3,
                spaceBetween: 30,
            },
        },
    });
</script>

<style>
    /* Section Layouts */
    .hero-section {
        padding: 8rem 0 6rem;
        position: relative;
        overflow: hidden;
    }

    .hero-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 4rem;
        align-items: center;
    }

    /* Background blobs */
    .blob {
        position: absolute;
        width: 600px;
        height: 600px;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
    }
    
    .blob-1 {
        top: -100px;
        left: -100px;
        background: radial-gradient(circle, var(--color-primary), transparent);
        animation: blob-float 10s infinite alternate;
    }
    
    .blob-2 {
        bottom: -100px;
        right: -100px;
        background: radial-gradient(circle, var(--color-secondary), transparent);
        animation: blob-float 12s infinite alternate-reverse;
    }

    .grid-overlay {
        position: absolute;
        inset: 0;
        background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
    }

    @keyframes blob-float {
        0% { transform: translate(0, 0); }
        100% { transform: translate(50px, 50px); }
    }

    /* Hero Content */
    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 100px;
        margin-bottom: 2rem;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--color-primary);
    }

    .live-dot {
        width: 8px;
        height: 8px;
        background: #ef4444;
        border-radius: 50%;
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        animation: pulse-red 2s infinite;
    }

    @keyframes pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    .hero-title {
        font-size: clamp(3rem, 6vw, 5.5rem);
        line-height: 1;
        font-weight: 800;
        margin-bottom: 1.5rem;
        letter-spacing: -0.04em;
    }

    .hero-desc {
        font-size: 1.25rem;
        color: var(--color-text-muted);
        max-width: 500px;
        margin-bottom: 2.5rem;
        line-height: 1.6;
    }

    .hero-actions {
        display: flex;
        gap: 1rem;
        margin-bottom: 3rem;
    }

    .btn-lg {
        padding: 1rem 2rem;
        font-size: 1.125rem;
    }

    .hero-stats {
        display: flex;
        align-items: center;
        gap: 2rem;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat {
        display: flex;
        flex-direction: column;
        line-height: 1.2;
    }

    .stat-num {
        font-size: 2rem;
        font-weight: 700;
        font-family: var(--font-display);
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .stat-divider {
        width: 1px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
    }

    /* Vinyl Visual */
    .hero-visual {
        display: flex;
        justify-content: center;
        align-items: center;
        perspective: 1000px;
    }

    .vinyl-container {
        position: relative;
        width: 400px;
        height: 400px;
    }

    .vinyl-record {
        position: absolute;
        top: 0;
        right: 0;
        width: 380px;
        height: 380px;
        background: #111;
        border-radius: 50%;
        background: repeating-radial-gradient(
          #111 0, 
          #111 2px, 
          #222 3px, 
          #222 4px
        );
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .vinyl-label {
        width: 140px;
        height: 140px;
        background: var(--color-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 4px solid #fff;
    }

    .logo-text {
        font-weight: 900;
        font-size: 1.5rem;
        color: white;
        letter-spacing: -1px;
    }

    .vinyl-cover {
        position: absolute;
        top: 20px;
        left: -40px;
        width: 400px;
        height: 400px;
        background: linear-gradient(135deg, var(--color-surface), #000);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 2;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        transform: rotate(-5deg);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.5s ease;
    }
    
    .vinyl-container:hover .vinyl-cover {
        transform: rotate(-5deg) translateX(-150px);
    }

    .cover-art {
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
        opacity: 0.2;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .spectrum-bars {
        display: flex;
        gap: 5px;
        align-items: center;
        height: 60px;
    }

    .spectrum-bars span {
        width: 8px;
        background: white;
        border-radius: 20px;
        animation: spectrum 1s infinite ease-in-out;
    }

    .spectrum-bars span:nth-child(odd) { animation-duration: 0.8s; }
    .spectrum-bars span:nth-child(even) { animation-duration: 1.2s; }
    
    @keyframes spectrum {
        0%, 100% { height: 10px; opacity: 0.5; }
        50% { height: 60px; opacity: 1; }
    }

    /* Episodes Section */
    .episodes-section {
        padding: 6rem 0;
        overflow: hidden;
    }

    .section-title {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .section-subtitle {
        color: var(--color-text-muted);
        font-size: 1.1rem;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 3rem;
    }

    .slider-nav {
        display: flex;
        gap: 1rem;
    }

    .swiper-button-prev-custom,
    .swiper-button-next-custom {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px solid var(--color-border);
        background: var(--color-surface);
        color: var(--color-text-main);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.2rem;
    }

    .swiper-button-prev-custom:hover,
    .swiper-button-next-custom:hover {
        background: var(--color-primary);
        color: white;
        border-color: var(--color-primary);
    }

    .center-action {
        text-align: center;
        margin-top: 3rem;
    }

    /* Info Grid */
    .info-section {
        padding: 6rem 0;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
    }

    .info-card {
        padding: 2.5rem;
        border-radius: var(--radius-lg);
        text-align: left;
        transition: transform 0.3s ease;
    }

    .info-card:hover {
        transform: translateY(-10px);
    }

    .info-icon {
        font-size: 3rem;
        display: block;
        margin-bottom: 1.5rem;
    }

    .info-card h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .info-card p {
        color: var(--color-text-muted);
        line-height: 1.6;
    }

    /* Marquee */
    .marquee-container {
        padding: 2rem 0;
        background: var(--color-primary);
        overflow: hidden;
        transform: rotate(-2deg) scale(1.05);
        margin: 4rem 0;
    }

    .marquee-content {
        white-space: nowrap;
        display: flex;
        animation: marquee 20s linear infinite;
    }

    .marquee-content span {
        font-size: 2rem;
        font-weight: 900;
        color: black;
        padding-right: 2rem;
        text-transform: uppercase;
        font-family: var(--font-display);
    }

    @keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }

    /* Final CTA */
    .final-cta {
        padding: 8rem 0;
        text-align: center;
        background: linear-gradient(to top, rgba(139, 92, 246, 0.1), transparent);
    }

    .cta-inner h2 {
        font-size: 3.5rem;
        margin-bottom: 1rem;
    }
    
    .cta-inner p {
        font-size: 1.25rem;
        color: var(--color-text-muted);
        margin-bottom: 2rem;
    }
    
    .btn-xl {
        padding: 1.25rem 3rem;
        font-size: 1.25rem;
    }

    @media (max-width: 960px) {
        .hero-grid {
            grid-template-columns: 1fr;
            text-align: center;
        }

        .hero-content {
            margin-bottom: 4rem;
        }

        .hero-actions, .hero-stats {
            justify-content: center;
        }

        .hero-visual {
            transform: scale(0.8);
        }

        .vinyl-container:hover .vinyl-cover {
            transform: rotate(-5deg) translateX(-50px) translateY(50px);
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
    }
</style>
