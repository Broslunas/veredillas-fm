---
import ThemeToggle from './ThemeToggle.astro';
import CommandPalette from './CommandPalette.astro';
import AuthButton from './AuthButton.astro';

const navItems = [
  { 
    label: 'Inicio', 
    href: '/', 
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>' 
  },
  { 
    label: 'Contenido', 
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>',
    dropdown: [
      { label: 'Blog', href: '/blog', icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>' },
      { label: 'Episodios', href: '/ep', icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>' },
      { label: 'Galería', href: '/galeria', icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>' }
    ]
  },
  { 
    label: 'Comunidad', 
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><circle cx="16" cy="7" r="4"/></svg>',
    dropdown: [
      { label: 'Equipo', href: '/equipo', icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>' },
      { label: 'Calendario', href: '/calendario', icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="10" x2="21" y2="10"/></svg>' }
    ]
  },
  { 
    label: 'Contacto', 
    href: '/contacto', 
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>' 
  },
];

const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
    if (href === '/') return currentPath === '/';
    return currentPath.startsWith(href);
};

const isDropdownActive = (items: any[]) => {
  return items?.some(item => isActive(item.href));
};
---

<header class="header-wrapper">
  <div class="header-inner">
    <!-- Left Pill: Logo -->
    <a href="/" class="pill logo-pill">
      <div class="logo-icon-wrapper">
        <img src="/logo.png" alt="Veredillas FM" class="logo-image" />
      </div>
      <span class="logo-text">Veredillas<span class="highlight">FM</span></span>
    </a>

    <!-- Right Pill: Navigation & Actions -->
    <nav class="pill nav-pill">
      <ul class="nav-list">
        {navItems.map((item) => (
          <li class="nav-item">
            {item.dropdown ? (
              <div class={`nav-dropdown ${isDropdownActive(item.dropdown) ? 'active' : ''}`}>
                <button class="nav-link dropdown-trigger">
                  <span class="nav-icon" set:html={item.icon}></span>
                  <span class="nav-text">{item.label}</span>
                  <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
                <div class="dropdown-menu">
                  {item.dropdown.map((subItem) => (
                    <a href={subItem.href} class={`dropdown-item ${isActive(subItem.href) ? 'active' : ''}`}>
                      <span class="dropdown-icon" set:html={subItem.icon}></span>
                      <span>{subItem.label}</span>
                    </a>
                  ))}
                </div>
              </div>
            ) : (
              <a href={item.href} class={`nav-link ${isActive(item.href) ? 'active' : ''}`}>
                <span class="nav-icon" set:html={item.icon}></span>
                <span class="nav-text">{item.label}</span>
              </a>
            )}
          </li>
        ))}
      </ul>
      
      <div class="divider"></div>

      <div class="actions">
        <CommandPalette />
        <a href="https://open.spotify.com/show/6mXWyLhzhET5EHk1p72j18" target="_blank" class="action-btn spotify-btn" aria-label="Escúchanos en Spotify">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.6 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
          </svg>
          <span class="spotify-tooltip">Escúchanos en Spotify</span>
        </a>
        <a href="https://music.amazon.es/podcasts/8d708ffa-7ef7-42f0-878d-fe3575491bef/veredillas-fm" target="_blank" class="action-btn amazon-btn" aria-label="Escúchanos en Amazon Music">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 48 48" fill="none">
            <path fill="#3cd0d9" fill-rule="evenodd" d="M42,15c0-4.967-4.033-9-9-9H15c-4.967,0-9,4.033-9,9v18	c0,4.967,4.033,9,9,9h18c4.967,0,9-4.033,9-9V15z" clip-rule="evenodd"/>
            <path fill="#fff" d="M35.982,28c-0.936,0-2.048,0.233-2.867,0.817c-0.234,0.175-0.234,0.408,0.059,0.408	c0.936-0.117,3.043-0.408,3.452,0.117c0.351,0.467-0.41,2.451-0.761,3.384c-0.117,0.292,0.117,0.35,0.351,0.175	c1.58-1.342,1.989-4.085,1.697-4.435C37.737,28.175,36.918,28,35.982,28z"/>
            <path fill="#fff" d="M10.15,28.8c1.81,1.133,3.64,2.215,5.561,3.032c1.914,0.815,3.922,1.398,5.94,1.406	c2.055,0.055,4.142-0.227,6.167-0.688c2.032-0.468,4.012-1.173,5.957-1.998c0.254-0.109,0.549,0.01,0.657,0.264	c0.1,0.235,0.006,0.505-0.21,0.631c-1.887,1.089-3.928,1.933-6.054,2.505c-2.132,0.572-4.334,0.822-6.563,0.786	c-2.276-0.119-4.455-0.812-6.405-1.821c-1.955-1.014-3.73-2.29-5.351-3.717c-0.104-0.092-0.114-0.25-0.023-0.354	C9.91,28.753,10.048,28.736,10.15,28.8z"/>
            <path fill="#fff" d="M22.5,26h-0.404C20.94,26,20,25.06,20,23.904V20h1v3.904C21,24.508,21.492,25,22.096,25H22.5	c0.603,0,1.5-0.897,1.5-1.5v-1h1v1C25,24.668,23.668,26,22.5,26z"/>
            <rect width="1" height="6" x="11" y="20" fill="#fff" fill-rule="evenodd" clip-rule="evenodd"/>
            <path fill="#fff" d="M11.391,22.21c-0.021-0.487,0.147-0.891,0.372-1.257c0.117-0.183,0.246-0.358,0.428-0.523	c0.202-0.171,0.434-0.283,0.672-0.359c0.984-0.292,2.011,0.305,2.438,1.196c0.223,0.451,0.202,0.994,0.199,1.324V26h-1v-3.409	c0.002-0.421,0.008-0.664-0.108-0.906c-0.209-0.498-0.826-0.719-1.335-0.704c-0.446-0.019-1.043,0.69-1.167,1.229H11.391z"/>
            <path fill="#fff" d="M14.75,22.21c-0.021-0.487,0.147-0.891,0.372-1.257c0.117-0.183,0.246-0.358,0.428-0.523	c0.202-0.171,0.434-0.283,0.672-0.359c0.984-0.292,2.011,0.305,2.438,1.196c0.223,0.451,0.202,0.994,0.199,1.324V26h-1v-3.409	c0.002-0.421,0.008-0.664-0.108-0.906c-0.209-0.498-0.826-0.719-1.335-0.704c-0.446-0.019-1.043,0.69-1.167,1.229H14.75z"/>
            <rect width="1" height="6" x="24" y="20" fill="#fff" fill-rule="evenodd" clip-rule="evenodd"/>
            <rect width="1" height="6" x="31" y="20" fill="#fff" fill-rule="evenodd" clip-rule="evenodd"/>
            <circle cx="31.5" cy="18" r="1" fill="#fff" fill-rule="evenodd" clip-rule="evenodd"/>
            <path fill="#fff" d="M34,22.62v0.76c0,0.89,0.73,1.62,1.62,1.62c0.43,0,0.84-0.17,1.15-0.47L37,24.3v1.3	c-0.41,0.26-0.88,0.4-1.38,0.4C34.18,26,33,24.82,33,23.38v-0.76c0-1.44,1.18-2.62,2.62-2.62c0.5,0,0.97,0.14,1.38,0.4v1.3	l-0.23-0.23c-0.31-0.3-0.72-0.47-1.15-0.47C34.73,21,34,21.73,34,22.62z"/>
            <path fill="#fff" d="M27.245,20.955C27.145,21.025,27,21.23,27,21.5c0,0.58,0.32,0.75,1.16,1.03	C28.94,22.78,30,23.14,30,24.5c0,0.52-0.2,0.95-0.59,1.25c-0.49,0.38-1.23,0.5-1.94,0.5c-0.54,0-1.08-0.07-1.47-0.14v-1.02	c0.94,0.19,2.28,0.28,2.79-0.13c0.1-0.07,0.21-0.19,0.21-0.46c0-0.58-0.32-0.75-1.16-1.03C27.06,23.22,26,22.86,26,21.5	c0-0.52,0.2-0.95,0.59-1.25c0.87-0.68,2.307-0.499,3.193-0.164v1.02C28.857,20.572,27.755,20.545,27.245,20.955z"/>
          </svg>
          <span class="spotify-tooltip">Escúchanos en Amazon Music</span>
        </a>
        <AuthButton />
        <ThemeToggle />
      </div>
    </nav>
  
  <!-- Mobile Menu Toggle -->
  <button id="menu-toggle" class="menu-toggle pill" aria-label="Abrir menú">
    <div class="hamburger-box">
      <span class="hamburger-inner"></span>
    </div>
  </button>
  </div>
  </header>
  
  <style>
  .header-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    padding: var(--spacing-md);
    pointer-events: none; /* Let clicks pass through the empty space */
  }
  
  .header-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .pill {
    background: rgba(10, 10, 11, 0.6); /* Glassy dark */
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 9999px;
    padding: 0.5rem 1.5rem;
    pointer-events: auto; /* Re-enable clicks */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
  }
  
  :global([data-theme="light"]) .pill {
      background: rgba(255, 255, 255, 0.7);
      border-color: rgba(0, 0, 0, 0.05);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  }
  
  /* Logo Pill */
  .logo-pill {
    padding-left: 0.5rem;
    padding-right: 1.5rem;
    gap: 0.75rem;
  }
  
  .logo-pill:hover, .nav-pill:hover {
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(10, 10, 11, 0.8);
      transform: translateY(-1px);
  }
  
  :global([data-theme="light"]) .logo-pill:hover, 
  :global([data-theme="light"]) .nav-pill:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(0, 0, 0, 0.08); /* Darker border on hover light */
  }
  
  .logo-icon-wrapper {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      overflow: hidden;
  }
  
  .logo-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
  }
  
  .logo-text {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 1.125rem;
    letter-spacing: -0.02em;
    color: var(--color-text-main);
  }
  
  .highlight {
    color: var(--color-primary);
  }
  
  /* Nav Pill (Desktop) */
  .nav-pill {
      padding: 0.4rem 1rem;
      gap: 1.5rem;
  }
  
  .nav-list {
    display: flex;
    list-style: none;
    gap: 0.5rem;
    margin: 0;
    padding: 0;
  }
  
  .nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-text-muted);
    font-weight: 500;
    font-size: 0.93rem;
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    transition: all 0.2s ease;
  }
  
  .nav-link:hover {
      color: var(--color-text-main);
      background: rgba(255, 255, 255, 0.05);
  }
  
  :global([data-theme="light"]) .nav-link:hover {
      background: rgba(0, 0, 0, 0.05);
  }
  
  /* Active State - New Visual style */
  .nav-link.active {
      color: #3b82f6; /* Blue-500 equivalent */
      background: rgba(255, 255, 255, 0.1);
      font-weight: 600;
  }
  
  :global([data-theme="light"]) .nav-link.active {
      color: var(--color-primary);
      background: rgba(0, 0, 0, 0.05);
  }
  
  .nav-icon {
      font-size: 1rem;
      display: flex;
  }
  
  /* Dropdown Styles */
  .nav-item {
    position: relative;
  }

  .nav-dropdown {
    position: relative;
  }

  .dropdown-trigger {
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
  }

  .dropdown-arrow {
    transition: transform 0.3s ease;
    margin-left: 0.25rem;
  }

  .nav-dropdown:hover .dropdown-arrow {
    transform: rotate(180deg);
  }

  .dropdown-menu {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(10, 10, 11, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 0.5rem;
    min-width: 200px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
  }

  /* Invisible bridge to prevent dropdown from closing */
  .dropdown-menu::before {
    content: '';
    position: absolute;
    top: -0.5rem;
    left: 0;
    right: 0;
    height: 0.5rem;
    background: transparent;
  }

  :global([data-theme="light"]) .dropdown-menu {
    background: rgba(255, 255, 255, 0.95);
    border-color: rgba(0, 0, 0, 0.08);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(-50%) translateY(0);
  }

  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.625rem 1rem;
    border-radius: 12px;
    color: var(--color-text-muted);
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .dropdown-item:hover {
    background: rgba(255, 255, 255, 0.08);
    color: var(--color-text-main);
  }

  :global([data-theme="light"]) .dropdown-item:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  .dropdown-item.active {
    color: var(--color-primary);
    background: rgba(139, 92, 246, 0.15);
  }

  .dropdown-icon {
    display: flex;
    opacity: 0.7;
  }

  .dropdown-item.active .dropdown-icon {
    opacity: 1;
  }

  /* Make Header More Compact */
  .header-wrapper {
    padding: 0.75rem var(--spacing-md);
  }

  .pill {
    padding: 0.375rem 1.25rem;
  }

  .logo-pill {
    padding-left: 0.375rem;
    padding-right: 1.25rem;
    gap: 0.625rem;
  }

  .logo-icon-wrapper {
    width: 36px;
    height: 36px;
  }

  .logo-text {
    font-size: 1rem;
  }

  .nav-pill {
    padding: 0.3rem 0.875rem;
    gap: 1.25rem;
  }

  .nav-link {
    padding: 0.4rem 0.875rem;
    font-size: 0.875rem;
  }
  
  /* Divider */
  .divider {
      width: 1px;
      height: 24px;
      background: rgba(255, 255, 255, 0.1);
  }
  
  :global([data-theme="light"]) .divider {
      background: rgba(0, 0, 0, 0.1);
  }
  
  /* Actions */
  .actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
  }
  
  .action-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      color: var(--color-text-muted);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
  }
  
  .action-btn:hover {
      color: var(--color-text-main);
      background: rgba(255, 255, 255, 0.05);
      transform: translateY(-2px);
  }
  
  :global([data-theme="light"]) .action-btn:hover {
      background: rgba(0, 0, 0, 0.05);
  }
  
  /* Spotify Button Enhanced */
  .spotify-btn {
      color: #1DB954; /* Spotify Green */
      position: relative;
  }
  
  .spotify-btn:hover {
      color: #1ed760;
      background: rgba(29, 185, 84, 0.15);
      box-shadow: 0 0 20px rgba(29, 185, 84, 0.3);
      transform: translateY(-2px) scale(1.05);
  }
  
  .spotify-btn::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1DB954, #1ed760);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
      filter: blur(8px);
  }
  
  .spotify-btn:hover::before {
      opacity: 0.4;
      animation: pulse 2s ease-in-out infinite;
  }
  
  @keyframes pulse {
      0%, 100% {
          transform: scale(1);
          opacity: 0.4;
      }
      50% {
          transform: scale(1.1);
          opacity: 0.6;
      }
  }
  
  /* Tooltip */
  .spotify-tooltip {
      position: absolute;
      bottom: -45px;
      left: 50%;
      transform: translateX(-50%) translateY(5px);
      background: rgba(29, 185, 84, 0.95);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
  }
  
  .spotify-tooltip::before {
      content: '';
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%) rotate(45deg);
      width: 8px;
      height: 8px;
      background: rgba(29, 185, 84, 0.95);
  }
  
  .spotify-btn:hover .spotify-tooltip {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
  }
  
  /* Amazon Button Enhanced */
  .amazon-btn {
      color: #3cd0d9; /* Amazon Cyan */
      position: relative;
  }
  
  .amazon-btn:hover {
      color: #6aeff6;
      background: rgba(60, 208, 217, 0.15);
      box-shadow: 0 0 20px rgba(60, 208, 217, 0.3);
      transform: translateY(-2px) scale(1.05);
  }
  
  .amazon-btn::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3cd0d9, #6aeff6);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
      filter: blur(8px);
  }
  
  .amazon-btn:hover::before {
      opacity: 0.4;
      animation: pulse 2s ease-in-out infinite;
  }
  
  /* Shared Tooltip styles handle the rest, but let's ensure tooltip background matches if specific needed */
  .amazon-btn .spotify-tooltip {
      background: rgba(60, 208, 217, 0.95);
      color: black;
  }
  
  .amazon-btn .spotify-tooltip::before {
      background: rgba(60, 208, 217, 0.95);
  }
  
  .amazon-btn:hover .spotify-tooltip {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
  }
  
  :global([data-theme="light"]) .amazon-btn .spotify-tooltip {
      background: #3cd0d9;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  :global([data-theme="light"]) .amazon-btn .spotify-tooltip::before {
      background: #3cd0d9;
  }

  :global([data-theme="light"]) .spotify-tooltip {
      background: #1DB954;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  :global([data-theme="light"]) .spotify-tooltip::before {
      background: #1DB954;
  }

  /* ========================================= */
  /* MOBILE REDESIGN (Hamburger)               */
  /* ========================================= */

  .menu-toggle {
      display: none;
      padding: 0;
      width: 40px;
      height: 40px;
      cursor: pointer;
      z-index: 200;
      justify-content: center;
      align-items: center;
      border: 1px solid rgba(255, 255, 255, 0.08);
  }

  .hamburger-box {
      width: 18px;
      height: 14px;
      position: relative;
  }

  .hamburger-inner {
      display: block;
      top: 50%;
      margin-top: -1px;
      width: 100%;
      height: 2px;
      background-color: var(--color-text-main);
      border-radius: 2px;
      position: absolute;
      transition: transform 0.15s ease;
  }

  .hamburger-inner::before,
  .hamburger-inner::after {
      content: "";
      display: block;
      width: 100%;
      height: 2px;
      background-color: var(--color-text-main);
      border-radius: 2px;
      position: absolute;
      transition: transform 0.15s ease;
  }

  .hamburger-inner::before { top: -6px; }
  .hamburger-inner::after { bottom: -6px; }

  /* Active State (X shape) */
  .menu-toggle.active .hamburger-inner {
      transform: rotate(45deg);
  }
  .menu-toggle.active .hamburger-inner::before {
      top: 0;
      opacity: 0;
  }
  .menu-toggle.active .hamburger-inner::after {
      bottom: 0;
      transform: rotate(-90deg);
  }

  @media (max-width: 1024px) {
      .header-wrapper {
          padding: 0.75rem 1rem;
      }
      
      .menu-toggle {
          display: flex;
          color: var(--color-text-main);
      }
      
      :global([data-theme="light"]) .menu-toggle {
          background: rgba(255, 255, 255, 0.7);
          border-color: rgba(0, 0, 0, 0.05);
      }

      /* Logo Pill */
      .logo-pill {
          padding-left: 0.25rem;
          padding-right: 1rem;
          background: rgba(10, 10, 11, 0.7);
          backdrop-filter: blur(12px);
      }

      /* NAV PILL - The Full Screen Overlay */
      .nav-pill {
          position: fixed !important;
          top: 0;
          left: 0;
          width: 100vw !important;
          height: 100vh !important; /* Fallback */
          height: 100dvh !important;
          margin: 0 !important;
          max-width: none !important;
          
          background: var(--color-bg); /* Opaque background */
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          z-index: 150;
          border-radius: 0 !important;
          border: none !important;
          padding: 2rem;
          box-sizing: border-box;
          
          /* Animation Start State */
          opacity: 0;
          visibility: hidden;
          transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
          pointer-events: none;
          
          /* Slide from bottom subtle */
          transform: translateY(20px) scale(0.98);
      }
      
      :global([data-theme="light"]) .nav-pill {
          background: #ffffff;
      }

      .nav-pill.menu-open {
          opacity: 1;
          visibility: visible;
          transform: translateY(0) scale(1);
          pointer-events: auto;
      }

      /* Navigation List Items */
      .nav-list {
          flex-direction: column;
          align-items: center;
          gap: 2rem;
          width: 100%;
      }

      .nav-link {
          font-size: 2rem; /* Larger font for immersion */
          font-weight: 700;
          padding: 0;
          width: auto;
          justify-content: center;
          flex-direction: row;
          background: transparent !important;
          
          /* Stagger Animation Setup */
          opacity: 0;
          transform: translateY(20px);
          transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      
      .menu-open .nav-link {
          opacity: 1;
          transform: translateY(0);
      }
      
      /* Stagger Delays */
      .menu-open li:nth-child(1) .nav-link { transition-delay: 0.1s; }
      .menu-open li:nth-child(2) .nav-link { transition-delay: 0.15s; }
      .menu-open li:nth-child(3) .nav-link { transition-delay: 0.2s; }
      .menu-open li:nth-child(4) .nav-link { transition-delay: 0.25s; }
      .menu-open li:nth-child(5) .nav-link { transition-delay: 0.3s; }

      .nav-text {
          display: inline-block;
      }
      
      .nav-icon {
          display: none; /* Hide icons for cleaner big text look, or keep if preferred */
      }
      .nav-icon svg {
          width: 32px;
          height: 32px;
      }

      /* Actions in Menu */
      .actions {
          flex-direction: row;
          scale: 1.5; /* Bigger actions */
          margin-top: 2rem;
          
          opacity: 0;
          transform: translateY(20px);
          transition: all 0.4s ease 0.4s; /* Delay after links */
      }
      
      .menu-open .actions {
          opacity: 1;
          transform: translateY(0);
      }

      .divider {
          display: none;
      }
      
      .nav-link.active {
          color: var(--color-primary);
      }
  }
</style>

<script>
  // Update active state on navigation (Client-side)
  document.addEventListener('DOMContentLoaded', () => {
    // 1. Highlight Active Link
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');
    
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href === '/') {
        if (currentPath === '/') link.classList.add('active');
        else link.classList.remove('active');
      } else {
         if (href && currentPath.startsWith(href)) {
             link.classList.add('active');
         } else {
             link.classList.remove('active');
         }
      }
    });

    // 2. Mobile Menu Logic
    const menuToggle = document.getElementById('menu-toggle');
    const navPill = document.querySelector('.nav-pill');
    
    if (menuToggle && navPill) {
        menuToggle.addEventListener('click', () => {
            const isOpen = navPill.classList.toggle('menu-open');
            menuToggle.classList.toggle('active');
            
            // Prevent body scroll when menu is open
            if (isOpen) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });

        // Close menu when clicking a link
        const links = navPill.querySelectorAll('a');
        links.forEach(link => {
            link.addEventListener('click', () => {
                navPill.classList.remove('menu-open');
                menuToggle.classList.remove('active');
                document.body.style.overflow = '';
            });
        });
    }
  });
</script>
