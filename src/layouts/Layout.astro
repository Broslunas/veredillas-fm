---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import MiniPlayer from '../components/MiniPlayer.astro';
import CookieConsent from '../components/CookieConsent.astro';
import ToastNotification from '../components/ToastNotification.astro';


interface Props {
	title: string;
	description?: string;
	image?: string;
	imageAlt?: string;
	type?: 'website' | 'article' | 'profile';
	publishedTime?: string;
	modifiedTime?: string;
	author?: string;
	tags?: string[];
	canonicalURL?: string;
	showFooter?: boolean;
    robots?: string;
}

const { 
	title, 
	description = "Veredillas FM es el podcast oficial del IES Veredillas. Descubre entrevistas exclusivas, noticias del instituto, cultura estudiantil y mucho m√°s. Una radio hecha por alumnos, para alumnos.",
	image = "/logo.png",
	imageAlt = "Veredillas FM - El podcast oficial del IES Veredillas",
	type = "website",
	publishedTime,
	modifiedTime,
	author = "Veredillas FM",
	tags = [],
	canonicalURL = new URL(Astro.url.pathname, Astro.site).href,
	showFooter = true,
    robots = "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
} = Astro.props;

// Asegurar que la imagen sea una URL completa
const ogImage = image.startsWith('http') ? image : new URL(image, Astro.site).href;
const siteUrl = Astro.site?.href || 'https://veredillasfm.es';
const fullTitle = title === "Inicio" ? "Veredillas FM - El Podcast del IES Veredillas" : `${title} | Veredillas FM`;
---

<!doctype html>
<html lang="es">
	<head>
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-N33MZ5JH43"></script>
		<script is:inline>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-N33MZ5JH43');
		</script>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Primary Meta Tags -->
		<title>{fullTitle}</title>
		<meta name="title" content={fullTitle} />
		<meta name="description" content={description} />
		<meta name="author" content={author} />
		{tags.length > 0 && <meta name="keywords" content={tags.join(', ')} />}
		<link rel="canonical" href={canonicalURL} />

		<link rel="icon" type="image/png" href="/favicon.png" sizes="512x512" />
		<link rel="apple-touch-icon" href="/favicon.png" />
		<!-- Open Graph / Facebook / WhatsApp / LinkedIn -->
		<meta property="og:type" content={type} />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:title" content={fullTitle} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={ogImage} />
		<meta property="og:image:alt" content={imageAlt} />
		<meta property="og:image:width" content="1200" />
		<meta property="og:image:height" content="630" />
		<meta property="og:site_name" content="Veredillas FM" />
		<meta property="og:locale" content="es_ES" />
		{publishedTime && <meta property="article:published_time" content={publishedTime} />}
		{modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
		{author && type === 'article' && <meta property="article:author" content={author} />}
		{tags.length > 0 && tags.map(tag => <meta property="article:tag" content={tag} />)}
		
		<!-- Twitter Card -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={canonicalURL} />
		<meta name="twitter:title" content={fullTitle} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={ogImage} />
		<meta name="twitter:image:alt" content={imageAlt} />
		<meta name="twitter:creator" content="@VeredillasFM" />
		<meta name="twitter:site" content="@VeredillasFM" />
		
		<!-- Additional SEO Meta Tags -->
		<meta name="robots" content={robots} />
		<meta name="googlebot" content="index, follow" />
		<meta name="language" content="Spanish" />
		<meta name="revisit-after" content="7 days" />
		<meta name="theme-color" content="#8b5cf6" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="apple-mobile-web-app-title" content="Veredillas FM" />
		<meta name="format-detection" content="telephone=no" />
		
		<!-- PWA Manifest -->
		<link rel="manifest" href="/manifest.json" />
		
		<!-- RSS Feed -->
		<link rel="alternate" type="application/rss+xml" title="Veredillas FM RSS Feed" href="/rss.xml" />
		
		<!-- Humans.txt -->
		<link rel="author" type="text/plain" href="/humans.txt" />
		
		<!-- Schema.org JSON-LD -->
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": type === 'article' ? "Article" : "WebSite",
			"name": "Veredillas FM",
			"description": description,
			"url": canonicalURL,
			"image": ogImage,
			"publisher": {
				"@type": "Organization",
				"name": "Veredillas FM",
				"logo": {
					"@type": "ImageObject",
					"url": new URL("/logo.png", Astro.site).href
				}
			},
			...(type === 'article' && publishedTime ? {
				"datePublished": publishedTime,
				"dateModified": modifiedTime || publishedTime,
				"author": {
					"@type": "Person",
					"name": author
				}
			} : {
				"potentialAction": {
					"@type": "SearchAction",
					"target": {
						"@type": "EntryPoint",
						"urlTemplate": `${siteUrl}/blog?q={search_term_string}`
					},
					"query-input": "required name=search_term_string"
				}
			})
		})} />
		
        


        <script is:inline>
            // Initialize theme from LocalStorage or Cookies
            const getCookie = (name) => {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }
            
            const theme = localStorage.getItem('theme') || getCookie('theme');
            
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        </script>
	</head>

	<body>
		<Header />
        
        <!-- Global Loader -->
        <div id="global-loader" aria-hidden="true">
            <div class="loader-content">
                <img src="/logo.png" alt="Veredillas FM" class="loader-logo" />
                <div class="loader-spinner"></div>
            </div>
        </div>



		<main>
			<slot />
		</main>
		{showFooter && <Footer />}
        <MiniPlayer />
        <CookieConsent />
        <ToastNotification />
	</body>
</html>

<style>
	main {
		min-height: 100vh;
		padding-top: 100px; /* Increased space for floating header */
	}

    @media (max-width: 768px) {
        main {
            padding-top: 80px; /* Smaller header on mobile */
        }
    }


    /* Loader Styles */
    #global-loader {
        position: fixed;
        inset: 0;
        z-index: 99999;
        background: var(--color-bg);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 1;
        transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    }

    #global-loader.fade-out {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }

    .loader-content {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .loader-logo {
        width: 80px;
        height: 80px;
        position: relative;
        z-index: 2;
        border-radius: 50%;
        animation: pulse 2s infinite ease-in-out;
    }

    .loader-spinner {
        position: absolute;
        inset: -15px;
        border: 3px solid transparent;
        border-top-color: var(--color-primary);
        border-right-color: var(--color-accent, #ec4899);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(0.95); opacity: 0.8; }
    }
</style>

<script>
    // Handle Loader
    window.addEventListener('load', () => {
        const loader = document.getElementById('global-loader');
        if (loader) {
            setTimeout(() => {
                loader.classList.add('fade-out');
            }, 500); // Small delay for smoother experience
        }
    });
</script>


